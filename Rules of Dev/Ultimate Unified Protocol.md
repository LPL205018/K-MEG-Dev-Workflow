# Vibe Coding Agent Team: 終極開發協定 (Ultimate Unified Protocol)
# 版本：v1.2 | 狀態：MANDATORY | 排除所有資訊熵

## 一、 架構穩定性與設計原則 (Structural Integrity)
* **單一事實來源 (SSOT):** 任何業務邏輯或數據定義在代碼庫中僅能存在於唯一位置。
* **物理隔離標準:**
    * **Logic vs. IO:** 核心業務邏輯禁止依賴外部 IO。必須透過抽象介面（Interface）進行溝通。
    * **Stateless Core:** 盡可能使用純函數 (Pure Functions)，確保輸入輸出一致性。
* **組件規模硬性限制:**
    * 單一函數嚴禁超過 50 行（邏輯行）；單一檔案嚴禁超過 300 行。
* **依賴注入 (DI):** 禁止在組件內部 `new` 具體實作類。所有依賴必須由外部注入。
* **禁止向上依賴:** 工具類或數據庫封裝層嚴禁引用業務工作流。
* **拒絕過度工程 (YAGNI):** 嚴禁為未來「可能」的需求預留複雜架構，但必須保持可重構性。
* **火車殘骸禁止 (Law of Demeter):** 嚴禁跨級調用屬性（例如：`a.b().c().d()`）。
* **循環依賴熔斷:** 嚴禁 A -> B -> A 引用，偵測到必須立即重構為仲裁者模式。

## 二、 代碼可讀性與命名慣例 (Readability & Naming)
* **意圖導向命名:** 拒絕 `data`, `info`, `item`, `handle` 等模糊詞彙。
    * *範例：* 使用 `validateUserPayload` 而非 `handleData`。
* **標示符格式:**
    * **PascalCase:** 類別、介面、型別、列舉。
    * **camelCase:** 變數、函數、成員。
    * **UPPER_SNAKE_CASE:** 常數、魔術數字替代值。
* **布林語義化:** 必須以 `is`, `has`, `should`, `can`, `did` 開頭。
* **函數原子化:** 每個函數僅做一件事。若需要註釋區分步驟，必須拆分子函數。
* **提前回傳 (Early Return):** 優先處理異常邊界，嚴禁深層 `if-else` 嵌套。
* **註釋哲學:** 解釋「為什麼 (Why)」而非「做什麼 (What)」。代碼更新則註釋必須同步更新。
* **TODO 規範:** 必須標註 `// TODO(Name): 方向`，禁止無名技術債。

## 三、 防禦性編程與安全性 (Defensive & Security)
* **外部輸入零信任:** 所有 API 參數與用戶輸入必須經過「白名單格式化」與「型別強制轉換」。
* **注入防護:** * **SQL:** 強制使用參數化查詢，嚴禁字串拼接。
    * **XSS:** 渲染至前端數據必須轉義。
* **溢位檢查:** 處理陣列索引或數值計算前，必須執行範圍驗證。
* **失敗導向設計:** * **優雅降級:** 第三方失效時提供備援或友善代碼，嚴禁洩漏 Stack Trace。
    * **熔斷機制:** 實作 Timeout 與 Circuit Breaker，防止單點失效。
* **原子性 (Atomicity):** 多表操作必須包裹於 Transaction 中。
* **敏感數據保護:** * **日誌脫敏:** 嚴禁記錄密碼、Token、PII。
    * **加密:** 傳輸用 TLS 1.3+，存儲用 Argon2/BCrypt 加鹽雜湊。
* **憑證管理:** 嚴禁硬編碼 API Keys，必須使用 Secrets Manager 或環境變數。

## 四、 自動化品質保證與錯誤處理 (QA & Error Handling)
* **測試體系:** * **單元測試:** 覆蓋快樂路徑與邊際情況。
    * **Mock 依賴:** 測試禁止連結真實 DB 或網路。
    * **回歸測試:** Bug 修復後必須補齊對應測試案例。
* **靜態分析:** 提交前必須通過 Linter（無 `console.log`、無死代碼）。
* **CI/CD Pipeline:** 進入主分支前必須自動通過編譯、測試與安全掃描。
* **可觀測性:** * **結構化日誌:** 使用 JSON 格式並包含 Trace ID。
    * **主動告警:** 錯誤率超標自動通知開發團隊。
* **錯誤處理語義化:** * **禁止空捕獲:** 嚴禁 `catch (e) {}`。
    * **異常分類:** 區分業務異常（如餘額不足）與系統崩潰（如 DB 中斷）。