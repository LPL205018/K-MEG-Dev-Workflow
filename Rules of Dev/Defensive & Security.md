# 開發守則：第三部分 - 防禦性編程與安全性 (Defensive & Security)
# 版本：v1.0 | 狀態：CRITICAL (核心防護)

## 1. 外部輸入零信任 (Zero Trust Input)
* **強制驗證：** 嚴禁直接將外部輸入（API Params, User Input, Header）透傳至業務邏輯或資料庫。
    * *執行：* 所有輸入必須經過「白名單格式化」與「型別強制轉換」。
* **防止注入攻擊 (Injection Prevention)：**
    * **SQL 注入：** 嚴禁使用字串拼接組成 SQL 指令，必須使用參數化查詢 (Prepared Statements)。
    * **XSS 防範：** 渲染至前端的數據必須經過適當的轉義 (Escaping)，禁止直接執行未經驗證的 HTML 字串。
* **溢位與邊界檢查：** 處理陣列索引、數值計算（特別是金融或科學計算）前，必須先行驗證範圍，防止溢位 (Overflow) 或越界存取。

## 2. 失敗導向設計 (Fail-Safe Design)
* **預期失敗 (Graceful Degradation)：** 當第三方服務或資料庫不可用時，系統必須具備備援方案或回傳友好的錯誤訊息，嚴禁直接噴出系統堆疊軌跡 (Stack Trace)。
* **熔斷機制 (Circuit Breaker)：** 對於高延遲或不穩定的外部服務調用，必須實作逾時 (Timeout) 與熔斷機制，防止單一節點失效拖垮整個系統。
* **原子性操作：** 涉及多表操作或狀態變更時，必須包裹在事務 (Transaction) 內。確保操作「要麼全做，要麼全不做」。

## 3. 敏感數據保護 (Data Privacy)
* **日誌脫敏：** 嚴禁在日誌 (Logs) 中紀錄敏感資訊，包括但不限於：密碼、Token、信用卡號、個人身份證號。
* **加密傳輸與存儲：**
    * 傳輸中 (In-transit)：強制執行 TLS 1.3+ 加密。
    * 存儲中 (At-rest)：敏感數據（如密碼）必須使用強雜湊算法（如 Argon2 或 BCrypt）並加鹽 (Salting) 存儲。
* **憑證管理：** 嚴禁將 API Keys、密鑰硬編碼在代碼中。必須使用環境變數或秘密管理服務 (Secrets Manager)。

## 4. 錯誤處理語義化 (Semantic Error Handling)
* **精準捕獲：** 避免使用「空捕獲」(Empty Catch)。捕獲異常後，必須進行記錄、修復或重新拋出更具意義的業務異常。
    * *禁止：* `try { ... } catch (e) {}`
* **異常分類：** 區分「預期內異常」（如：餘額不足）與「系統崩潰異常」（如：資料庫連接中斷）。前者屬於業務流程，後者應觸發報警。